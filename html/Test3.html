<!DOCTYPE html>
<!--[if lt IE 7]> <html class="lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]> <html class="lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]> <html class="lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html lang="en" xmlns="http://www.w3.org/1999/html"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>SafeWalk</title>

    <link rel="stylesheet" href="../css/StatusStyle.css">
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
       <!--[if lt IE 9]><script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
    <script type='text/javascript' src='https://cdn.firebase.com/js/client/1.0.6/firebase.js'></script>
    ////
    <script src="http://code.angularjs.org/1.2.6/angular.min.js"></script>
    <script src="https://cdn.firebase.com/v0/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/angularfire/0.5.0/angularfire.min.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
    <script>

            var myLatlng = new google.maps.LatLng(44.935, -93.1682);

            function initialize() {

                var mapOptions = {
                    zoom: 14,
                    center: myLatlng


                };


                var Boundaries;

               var map = new google.maps.Map(document.getElementById('map-canvas'),
                        mapOptions);
                //Set Map Boundaries

          // Define the LatLng coordinates for the polygon's path.
            var BoundaryCoords = [
                new google.maps.LatLng(44.948536,-93.146714),
                new google.maps.LatLng(44.926951,-93.146639),
                new google.maps.LatLng(44.927088,-93.187344),
                new google.maps.LatLng(44.948368,-93.187301),
                new google.maps.LatLng(44.948536,-93.146714)

            ];

            // Construct the polygon.
            Boundaries = new google.maps.Polygon({
                paths: BoundaryCoords,
                strokeColor: '#FF0000',
                strokeOpacity: 0.8,
                strokeWeight: 2,
                fillColor: '#00FF7F',
                fillOpacity: 0.35
            });


                Boundaries.setMap(map);
            }



            google.maps.event.addDomListener(window, 'load', initialize);
    </script>
</head>
<body>

    <div id="topheading">SafeWalk</div>

    <div id="StatusBlock">
        <h1 id='messagesDiv'>Status: </h1>

        <div id='InnerStatusBlock'>Status:</div>

        <script>
            // Get a reference to the root of the chat data.
            var messageRef = new Firebase('https://safewalk.firebaseio.com/');

            messageRef.on('value', function(snapshot) {
                var Status = snapshot.child('Status').val();
                $('#InnerStatusBlock').html(Status);


                   if(Status=='Available'){
                       $('#InnerStatusBlock').css("background-color","green");
                   } else if(Status=='Busy'){
                       $('#InnerStatusBlock').css("background-color","orange");
                       //$('#InnerScreen').html(Status);

                   } else {
                       $('#InnerStatusBlock').css("background-color","red");
                       //$('#InnerScreen').html(Status);

                   }
            });

        </script>

    </div>

    <div id="map-canvas" style="width: 550px; height: 540px"></div>


    <!--http://www.w3schools.com/jquery/tryit.asp?filename=tryjquery_html_text_set-->


    <div id="buttonsSection">

        <h1>Click Availability </h1>
            <a class="submit" id="Available" onclick="messageRef.child('Status').set('Available')"><span>Available</span></a>
            <a class="submit" id="Busy" onclick="messageRef.child('Status').set('Busy')"><span>Busy</span></a>
            <a class="submit" id="NotAvailable" onclick="messageRef.child('Status').set('Not Available')"><span>Not Available</span></a>
   </div>

    //represents how the data will be inputted into firebase from the android phone apps
    <input style="display:block" type='text' id='nameInput' placeholder='Name'>
    <input style="display:inline-block"type='text' id='Number' placeholder='Phone Number...'>
    <input style="display:inline-block"type='text' id='messageInput' placeholder='Message...'>

    <div id="NotificationScreen" style="overflow: scroll; ">Requests: </div>
    <script>

        // Get a reference to the root of the chat data.
        var Notifications = new Firebase('https://safewalk.firebaseio.com/Notifications');

        // When the user presses enter on the message input, write the message to firebase.
        $('#messageInput').keypress(function (e) {
            if (e.keyCode == 13) {
                var name = $('#nameInput').val();
                var phone= $('#Number').val();
                var text = $('#messageInput').val();
                Notifications.push({name:name, text:text, phone:phone});
                $('#messageInput').val('');
            }
        });

        // Add a callback that is triggered for each chat message.
       Notifications.limit(10).on('child_added', function (snapshot) {
           var message = snapshot.val();

           // $('<p/>').text(message.text+'\t'+message.name).prepend($('<em/>').appendTo('#NotificationScreen'));
           $('#NotificationScreen').append("<div class=\"request\" data-request-id='" + snapshot.name() + "'>" +
                   "<div class='inline-block message'>" +
                         "<div>" + message.name +';'+ message.phone + "</div>" +
                         "<div class=\"coordinates\">" +message.text + "</div>" +
                   "</div>" +
                   " <div class='inline-block'>" +
                        " <a class='request-done'><i class='icon-remove-sign' style='margin:auto'>"
                         + "</i>Done</a>" +
                   "</div>" +
           "</div>");
        });

        $(document).on("click", "#NotificationScreen .coordinates", function() {
            var request = $(this).parent().parent();

            var Location = new Firebase('https://safewalk.firebaseio.com/Notifications/' + request.data("request-id"));
            location.on('value', function (snapshot) {

                console.log(location.child('text') );
            });

        });



        $(document).on("click", "#NotificationScreen .request-done", function() {
            var request = $(this).parent().parent();
            var url = new Firebase('https://safewalk.firebaseio.com/Notifications/' + request.data("request-id"));
            url.remove();
            request.remove();
            console.log(url);
        });

    </script>

                       <!--HI kohei-->

</body>
</html>


        <!--Ticker reference:http://jsfiddle.net/saadshahd/3smGz/-->
<!--Link to JQuery library online from google APIs. Have already downloading the library>
"http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.js"
        -->